<head>
    <script src="/assets/js/jquery.min.js"> </script>
    
</head>

<body>

    <label> SIGNUP TEST</label>
    <form method="POST" action="javascript:user_signup();">

        <label for="username">username</label>
        <input id="signup-username" type="text" name="username" required>

        <label for="password">password</label>
        <input id="signup-password" type="password" name="password" required>

        <label for="password">password confirmation</label>
        <input id="signup-password-confirmation" type="password" name="password" required>

        <input type="submit" value="signup" >

        <label id="signup-answer"></label>

    </form>

    <label> LOGIN TEST </label>
    <form method="POST" action="javascript:user_login()">

        <label for="username" >username</label>
        <input id="login-username" type="text" name="username" required>

        <label for="password">password</label>
        <input id="login-password" type="text" name="password" required>

        <input type="submit" value="login" >

        <label id="login-answer"></label>

    </form>

    <label> LOG OUT </label>
    <form method="POST" action="javascript:user_logout();">
    
        <input type="submit" value="logout">
    
        <label id="logout-answer"></label>
    
    </form>

    <label> CANVA CREATION </label>
    <form method="POST" action="javascript:canva_generation();">

        <label for="name">name</label>
        <input id="canva-generation-name" type="text" name="name" required>

        <label for="height">height</label>
        <input id="canva-generation-height" type="number" name="height" required>
       
        <label for="width">width</label>
        <input id="canva-generation-width" type="number" name="width" required>


        <input type="submit" value="generation">
    
        <label id="canva-generation-answer"></label>
    
    </form>

    <label> GET MY CANVAS </label>
    <form method="GET" action="javascript:canva_getusercanvas();">
    
        <input type="submit" value="canva-usercanvas">
    
        <label id="canva-usercanvas-answer"></label>
    
    </form>

   <!--
 <div id="painting">
        <canvas id="canva"></canvas>
    </div>
   --> 
   
<form method="POST" action="javascript:page_view();">

    <label for="page-view-link">page link</label>
    <input id="page-view-link" type="text" name="page-view-link" required>
    
    
    <input type="submit" value="view page">

    <iframe id="page" title="Inline Frame Example" width="1000" height="800"></iframe>

   

</form>

<form method="POST" action="javascript:canva_get();">

    <label for="canva-get-id">canva id</label>
    <input id="canva-get-id" type="text" name="canva-get-id" required>

    <label id="canva-get-answer"></label>

    <input type="submit" value="get canva">


    <canvas id="canva-get-canva" style="border:1px solid black;"></canvas>

    


</form>

   



   


   
    
    <script>
        function user_signup() {

            console.log("signup entered");

            var dataToPost = {
                login: $('#signup-username').val(),
                password: $('#signup-password').val(),
                password_confirmation: $('#signup-password-confirmation').val()
            };

            console.log(dataToPost);

            $.ajax({
                type: 'POST',
                url: '/users/signup?tests=true',
                timeout: 3000,
                data: dataToPost,
                success: function (data) {
                    console.log("OK");
                    $('#signup-answer').html(data);
                },
                error: function (err) {
                    console.log(err);
                    console.log("ERROR");
                    $('#signup-answer').html(err.responseText);
                }
            });

        }

        function user_login() {

            console.log("login entered");

            var dataToPost = {
                login: $('#login-username').val(),
                password: $('#login-password').val()
            };

            console.log(dataToPost);

            $.ajax({
                type: 'POST',
                url: '/users/login?tests=true',
                timeout: 3000,
                data: dataToPost,
                success: function (data) {
                    console.log("OK");
                    $('#login-answer').html(data);
                },
                error: function (err) {
                    console.log(err);
                    console.log("ERROR");
                    $('#login-answer').html(err.responseText);
                }
            });

        }
        
        function user_logout() {

            console.log("logout entered");

            var dataToPost = {};

            console.log(dataToPost);

            $.ajax({
                type: 'POST',
                url: '/users/logout?tests=true',
                timeout: 3000,
                data: dataToPost,
                success: function (data) {
                    console.log("OK");
                    $('#logout-answer').html(data);
                },
                error: function (err) {
                    console.log(err);
                    console.log("ERROR");
                    $('#logout-answer').html(err.responseText);
                }
            });

        }

        function canva_generation() {

            console.log("canva_generation entered");

            var dataToPost = {
                name: $('#canva-generation-name').val(),
                height: $('#canva-generation-height').val(),
                width: $('#canva-generation-width').val()
            };

            console.log(dataToPost);

            $.ajax({
                type: 'POST',
                url: '/canvas/generate?tests=true',
                timeout: 3000,
                data: dataToPost,
                success: function (data) {
                    console.log("OK");
                    $('#canva-generation-answer').html(data);
                },
                error: function (err) {
                    console.log(err);
                    console.log("ERROR");
                    $('#canva-generation-answer').html(err.responseText);
                }
            });

        }

        function canva_getusercanvas() {
            console.log("canva_usercanvas entered");

            var dataToPost = {};

            console.log(dataToPost);

            $.ajax({
                type: 'POST',
                url: '/canvas/accessible',
                timeout: 3000,
                data: dataToPost,
                success: function (data) {
                    console.log("OK");
                    console.log(data)
                    $('#canva-usercanvas-answer').html(JSON.stringify(data));
                },
                error: function (err) {
                    console.log(err);
                    console.log("ERROR");
                    $('#canva-usercanvas-answer').html(err.responseText);
                }
            });
        }

        function page_view() {

            console.log("page_view entered");

            var dataToPost = {

            };

            console.log(dataToPost);

            $('#page').attr('src', $("#page-view-link").val());

        }


        function canva_get() {

            console.log("canva_get entered");

            var dataToPost = {
                idCanva: $('#canva-get-id').val()
            };

            console.log(dataToPost);

            $.ajax({
                type: 'POST',
                url: '/canvas/getImage',
                data: dataToPost,
                responseType: 'arraybuffer',
                cache:false,
                mimeType: 'image/png',
                success: function (data,status,xhr) {
                    console.log("OK");
                    // Create an image object from the response data
                    var image = new Image();
                    image.src = "data:image/png;base64,"+data;

                    // Draw the image on the canvas
                    image.onload = function () {
                        var canvas = document.getElementById('canva-get-canva');
                        canvas.width = image.width;
                        canvas.height = image.height;
                        var ctx = canvas.getContext('2d');
                        ctx.drawImage(image, 0, 0);
                    }

                },
                error: function (err) {
                    console.log("ERROR");
                    console.log(err);
                    $('#canva-get-answer').html(err.responseText);

                }
            });

            
        }

    </script>

</body>

<footer>
    <script src="/assets/js/canva.js" defer></script>
</footer>